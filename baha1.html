<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8" />
<title>–°–ª–æ–≤–∞—Ä—å —Å —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π, –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ–º –∏ —Ç–µ—Å—Ç–∞–º–∏</title>
<style>
  body { font-family: Arial, sans-serif; max-width: 600px; margin: 20px auto; }
  input, textarea { width: 100%; margin: 5px 0; padding: 8px; }
  button { margin: 5px 5px 15px 0; padding: 8px 15px; cursor: pointer; }
  .word-item { border-bottom: 1px solid #ddd; padding: 10px 0; }
  .word-item span { display: block; }
  #filterButtons button { margin-right: 10px; }
  #testSection { background: #f0f0f0; padding: 15px; margin-top: 30px; border-radius: 8px; }
  #testWord { font-size: 1.5em; font-weight: bold; }
  #testResult { margin-top: 10px; }
</style>
</head>
<body>

<h1>–ú–æ–π —Å–ª–æ–≤–∞—Ä—å –∫–æ—Ä–µ–π—Å–∫–æ–≥–æ –∏ –∞–Ω–≥–ª–∏–π—Å–∫–æ–≥–æ</h1>

<label>–°–ª–æ–≤–æ:</label>
<input type="text" id="wordInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, apple" />
<label>–ü–µ—Ä–µ–≤–æ–¥:</label>
<input type="text" id="translationInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, —è–±–ª–æ–∫–æ" />
<label>–ü—Ä–∏–º–µ—Ä –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è:</label>
<textarea id="exampleInput" placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä, I eat an apple"></textarea>

<button id="addWordBtn">–î–æ–±–∞–≤–∏—Ç—å —Å–ª–æ–≤–æ</button>
<button id="exportBtn">–≠–∫—Å–ø–æ—Ä—Ç —Å–ª–æ–≤</button>
<input type="file" id="importInput" style="display:none" accept=".json" />
<button id="importBtn">–ò–º–ø–æ—Ä—Ç —Å–ª–æ–≤</button>

<h2>–§–∏–ª—å—Ç—Ä —Å–ª–æ–≤:</h2>
<div id="filterButtons">
  <button data-filter="all" class="filterBtn">–í—Å–µ</button>
  <button data-filter="new" class="filterBtn">–ù–æ–≤—ã–µ</button>
  <button data-filter="learned" class="filterBtn">–í—ã—É—á–µ–Ω–Ω—ã–µ</button>
</div>

<h2>–°–ª–æ–≤–∞ –≤ —Å–ª–æ–≤–∞—Ä–µ:</h2>
<div id="wordsList"></div>

<hr>

<h2>–¢–µ—Å—Ç: –ø–æ–≤—Ç–æ—Ä–∏ —Å–ª–æ–≤–æ</h2>
<div id="testSection">
  <div id="testWord">–ù–∞–∂–º–∏ "–°–ª–µ–¥—É—é—â–µ–µ" —á—Ç–æ–±—ã –Ω–∞—á–∞—Ç—å —Ç–µ—Å—Ç</div>
  <button id="pronounceBtn" disabled>üîä –ü—Ä–æ–∏–∑–Ω–µ—Å—Ç–∏</button>
  <button id="markLearnedBtn" disabled>–û—Ç–º–µ—Ç–∏—Ç—å –∫–∞–∫ –≤—ã—É—á–µ–Ω–Ω–æ–µ</button>
  <button id="nextTestBtn">–°–ª–µ–¥—É—é—â–µ–µ —Å–ª–æ–≤–æ</button>
  <div id="testResult"></div>
</div>

<script>
let wordData = JSON.parse(localStorage.getItem('myWords')) || {words: []};
let currentFilter = 'all';
let testIndex = null;

// –§—É–Ω–∫—Ü–∏—è —Ä–µ–Ω–¥–µ—Ä–∞ —Å–ø–∏—Å–∫–∞ —Å–ª–æ–≤ —Å —Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏–µ–π
function renderWords() {
  const container = document.getElementById('wordsList');
  container.innerHTML = '';
  let filteredWords = wordData.words;
  if(currentFilter !== 'all') {
    filteredWords = wordData.words.filter(w => w.status === currentFilter);
  }
  if(filteredWords.length === 0) {
    container.innerHTML = '<p>–°–ª–æ–≤ –Ω–µ—Ç –¥–ª—è –≤—ã–±—Ä–∞–Ω–Ω–æ–≥–æ —Ñ–∏–ª—å—Ç—Ä–∞.</p>';
    return;
  }
  filteredWords.forEach((item, idx) => {
    const div = document.createElement('div');
    div.className = 'word-item';
    div.innerHTML = `
      <strong>${item.word}</strong> ‚Äî <em>${item.translation}</em> [${item.status}]
      <span>–ü—Ä–∏–º–µ—Ä: ${item.example || '–Ω–µ—Ç'}</span>
      <button onclick="toggleStatus(${wordData.words.indexOf(item)})">
        ${item.status === 'new' ? '–û—Ç–º–µ—Ç–∏—Ç—å –≤—ã—É—á–µ–Ω–Ω—ã–º' : '–û—Ç–º–µ—Ç–∏—Ç—å –Ω–æ–≤—ã–º'}
      </button>
      <button onclick="pronounceWord('${item.word}')">üîä</button>
      <button onclick="deleteWord(${wordData.words.indexOf(item)})">–£–¥–∞–ª–∏—Ç—å</button>
    `;
    container.appendChild(div);
  });
}

// –î–æ–±–∞–≤–ª—è–µ–º —Å–ª–æ–≤–æ
document.getElementById('addWordBtn').onclick = () => {
  const word = document.getElementById('wordInput').value.trim();
  const translation = document.getElementById('translationInput').value.trim();
  const example = document.getElementById('exampleInput').value.trim();

  if (!word || !translation) {
    alert('–°–ª–æ–≤–æ –∏ –ø–µ—Ä–µ–≤–æ–¥ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã!');
    return;
  }

  wordData.words.push({word, translation, example, status: 'new'});
  localStorage.setItem('myWords', JSON.stringify(wordData));
  clearInputs();
  renderWords();
};

// –û—á–∏—Å—Ç–∫–∞ –∏–Ω–ø—É—Ç–æ–≤
function clearInputs() {
  document.getElementById('wordInput').value = '';
  document.getElementById('translationInput').value = '';
  document.getElementById('exampleInput').value = '';
}

// –£–¥–∞–ª–µ–Ω–∏–µ —Å–ª–æ–≤–∞
function deleteWord(index) {
  if(!confirm('–£–¥–∞–ª–∏—Ç—å —Å–ª–æ–≤–æ?')) return;
  wordData.words.splice(index, 1);
  localStorage.setItem('myWords', JSON.stringify(wordData));
  renderWords();
}

// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å—Ç–∞—Ç—É—Å–∞ —Å–ª–æ–≤–∞
function toggleStatus(index) {
  const word = wordData.words[index];
  word.status = (word.status === 'new') ? 'learned' : 'new';
  localStorage.setItem('myWords', JSON.stringify(wordData));
  renderWords();
}

// –≠–∫—Å–ø–æ—Ä—Ç —Å–ª–æ–≤
document.getElementById('exportBtn').onclick = () => {
  const blob = new Blob([JSON.stringify(wordData)], {type: 'application/json'});
  const url = URL.createObjectURL(blob);
  const a = document.createElement('a');
  a.href = url;
  a.download = 'myWords.json';
  a.click();
  URL.revokeObjectURL(url);
};

// –ò–º–ø–æ—Ä—Ç —Å–ª–æ–≤
document.getElementById('importBtn').onclick = () => {
  document.getElementById('importInput').click();
};

document.getElementById('importInput').onchange = function(event) {
  const file = event.target.files[0];
  if (!file) return;

  const reader = new FileReader();
  reader.onload = function(e) {
    try {
      const imported = JSON.parse(e.target.result);
      if (!imported.words || !Array.isArray(imported.words)) {
        alert('–ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞');
        return;
      }
      wordData = imported;
      localStorage.setItem('myWords', JSON.stringify(wordData));
      renderWords();
      alert('–ò–º–ø–æ—Ä—Ç —É—Å–ø–µ—à–Ω–æ –≤—ã–ø–æ–ª–Ω–µ–Ω!');
    } catch (err) {
      alert('–û—à–∏–±–∫–∞ –ø—Ä–∏ —á—Ç–µ–Ω–∏–∏ —Ñ–∞–π–ª–∞: ' + err.message);
    }
  };
  reader.readAsText(file);
};

// –§–∏–ª—å—Ç—Ä—ã
document.querySelectorAll('.filterBtn').forEach(btn => {
  btn.onclick = () => {
    currentFilter = btn.getAttribute('data-filter');
    renderWords();
  };
});

// –ü—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ —Å–ª–æ–≤–∞ —á–µ—Ä–µ–∑ Web Speech API
function pronounceWord(text) {
  if (!('speechSynthesis' in window)) {
    alert('–ü—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –≤–∞—à–µ–º –±—Ä–∞—É–∑–µ—Ä–µ');
    return;
  }
  const utterance = new SpeechSynthesisUtterance(text);
  // –ú–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –≥–æ–ª–æ—Å –∏ —è–∑—ã–∫ —Ç—É—Ç
  utterance.lang = 'en-US'; // –ú–æ–∂–Ω–æ –º–µ–Ω—è—Ç—å –Ω–∞ 'ko-KR' –¥–ª—è –∫–æ—Ä–µ–π—Å–∫–æ–≥–æ
  speechSynthesis.speak(utterance);
}

// –¢–µ—Å—Ç—ã ‚Äî –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ–µ —Å–ª–æ–≤–æ –∏–∑ –Ω–æ–≤—ã—Ö
function nextTestWord() {
  const newWords = wordData.words.filter(w => w.status === 'new');
  const testWordDiv = document.getElementById('testWord');
  const pronounceBtn = document.getElementById('pronounceBtn');
  const markBtn = document.getElementById('markLearnedBtn');
  const testResult = document.getElementById('testResult');

  if (newWords.length === 0) {
    testWordDiv.textContent = '–ù–µ—Ç –Ω–æ–≤—ã—Ö —Å–ª–æ–≤ –¥–ª—è —Ç–µ—Å—Ç–∞!';
    pronounceBtn.disabled = true;
    markBtn.disabled = true;
    testResult.textContent = '';
    testIndex = null;
    return;
  }
  
  testIndex = Math.floor(Math.random() * newWords.length);
  const word = newWords[testIndex];

  testWordDiv.textContent = word.word;
  pronounceBtn.disabled = false;
  markBtn.disabled = false;
  testResult.textContent = '';
}

// –û—Ç–º–µ—Ç–∏—Ç—å —Å–ª–æ–≤–æ –∫–∞–∫ –≤—ã—É—á–µ–Ω–Ω–æ–µ –∏–∑ —Ç–µ—Å—Ç–∞
document.getElementById('markLearned
